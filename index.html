<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Deepfake Defender</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --accent1: #00ffe5;
    --accent2: #b388ff;
    --card-bg: rgba(10,12,18,0.86);
    --muted: #b1cbe0;
  }
  html,body{height:100%; margin:0; font-family:Inter, system-ui, sans-serif; color:#e6f8ff;}
  body {
    /* fallback gradient (used if bg file not found) */
    background: linear-gradient(135deg,#071021,#0b1220 60%, #071026);
    background-size:cover;
    background-position:center;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* overlay so text is readable on background image */
  .bgOverlay {
    position: fixed; inset:0; pointer-events:none;
    background: linear-gradient(rgba(2,6,12,0.55), rgba(2,6,12,0.65));
    z-index:0;
  }

  .page {
    position:relative;
    z-index:2;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:36px 20px;
    box-sizing:border-box;
  }

  .container {
    width:100%;
    max-width:1100px;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:22px;
    align-items:start;
  }

  header{ grid-column:1/-1; text-align:center; margin-bottom:10px;}
  h1{ font-family: 'Orbitron', sans-serif; margin:0; color:var(--accent1); font-size:36px; text-shadow:0 0 12px rgba(0,255,229,0.12), 0 0 28px rgba(179,136,255,0.06);}
  p.subtitle{ margin:6px 0 18px; color:var(--accent2); opacity:0.95; font-weight:600; }

  .card {
    background: var(--card-bg);
    border-radius:14px;
    padding:20px;
    box-shadow: 0 6px 30px rgba(2,10,20,0.6);
    border:1px solid rgba(0,255,229,0.06);
  }

  h3{ font-family: 'Orbitron', sans-serif; margin:0 0 12px; color:var(--accent1); font-size:18px; }

  .controls { display:flex; gap:10px; flex-direction:column; }
  input[type=file] {
    border-radius:10px; padding:10px; border:1px dashed rgba(179,136,255,0.18);
    background: rgba(255,255,255,0.02); color:var(--muted); outline:none;
  }

  .btn {
    border:0; cursor:pointer; padding:10px 14px; border-radius:10px;
    font-weight:700; color:#071021;
    background: linear-gradient(90deg,var(--accent1),var(--accent2));
    box-shadow: 0 6px 20px rgba(0,255,229,0.06);
  }
  .btn:active{ transform:translateY(1px); }

  .preview {
    margin-top:14px;
    height:260px;
    border-radius:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    display:flex; justify-content:center; align-items:center; overflow:hidden;
    border:1px solid rgba(179,136,255,0.06);
  }
  .preview img, .preview video { max-width:100%; max-height:100%; display:block; border-radius:8px; }

  .progressOuter{ margin-top:12px; height:12px; background:rgba(255,255,255,0.04); border-radius:12px; overflow:hidden; }
  .progressInner{ height:100%; width:0%; background: linear-gradient(90deg,var(--accent1),var(--accent2)); transition:width .2s; }

  .metrics { display:flex; gap:12px; margin-top:16px; }
  .metric{ flex:1; padding:14px 8px; background: rgba(0,0,0,0.35); border-radius:10px; text-align:center; border:1px solid rgba(0,255,229,0.04); }
  .metric p{ margin:0; color:var(--accent2); font-size:13px; }
  .metric h2{ margin:6px 0 0; color:var(--accent1); font-size:26px; }

  pre#summary { margin-top:14px; background:#07101a; padding:12px; border-radius:8px; color:#cfefff; font-size:13px; border:1px solid rgba(0,255,229,0.03); min-height:100px; }

  footer { grid-column:1/-1; margin-top:18px; text-align:center; color:var(--accent2); font-size:13px; }

  /* responsive */
  @media (max-width:900px){
    .container{ grid-template-columns: 1fr; }
    h1{ font-size:30px; }
    .preview{ height:220px; }
  }
</style>
</head>
<body>
  <div class="bgOverlay"></div>

  <div class="page">
    <div class="container">
      <header>
        <h1>Deepfake Defender</h1>
        <p class="subtitle">Upload image â€¢ video â€¢ audio â€” detect manipulated media</p>
      </header>

      <!-- LEFT -->
      <div class="card">
        <h3>Upload Media</h3>
        <div class="controls">
          <input type="file" id="fileInput" accept="image/*,video/*,audio/*" />
          <div style="display:flex; gap:10px;">
            <button class="btn" id="analyzeBtn">Analyze</button>
            <button class="btn" id="clearBtn" style="background:transparent;color:var(--accent1);border:1px solid rgba(179,136,255,0.14)">Clear</button>
          </div>
        </div>

        <div class="preview" id="preview">Preview will appear here</div>

        <div class="progressOuter"><div class="progressInner" id="progressInner"></div></div>
        <p id="progressText" style="margin-top:8px;color:var(--muted)">Idle</p>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <h3>Results</h3>
        <div class="metrics">
          <div class="metric">
            <p>Safe Probability</p>
            <h2 id="safePct">â€”%</h2>
          </div>
          <div class="metric">
            <p>Risk of Fake</p>
            <h2 id="fakePct">â€”%</h2>
          </div>
        </div>

        <pre id="summary">No analysis yet.</pre>
      </div>

      <footer>ðŸ”’ Cybersecurity Awareness â€” Trust, but Verify</footer>
    </div>
  </div>

<script>
/*
  IMPORTANT:
  - Put your background image files in the same folder as this HTML, or update the array below to point to correct paths.
  - Backend upload URL: change BACKEND_URL if your server is at another address.
*/

const bgImages = [
  // exact filenames you earlier provided â€” keep them here (spaces/colons allowed)
  "WhatsApp Image 2025-09-17 at 14.52.17_7fec695d.jpg",
  "WhatsApp Image 2025-09-17 at 14.52.17_dd205003.jpg",
  "WhatsApp Image 2025-09-17 at 14.52.16_59af7d88.jpg",
  "WhatsApp Image 2025-09-17 at 14.52.17_2357f88e.jpg"
];

// If your server endpoint differs, update this:
const BACKEND_URL = "http://127.0.0.1:8000/analyze"; // change if needed

// utility to set background (uses encodeURI on filename to avoid issues with spaces)
function setRandomBackground(){
  const idx = Math.floor(Math.random()*bgImages.length);
  const file = bgImages[idx];
  // encode URI so spaces and special chars are handled
  const url = `linear-gradient(rgba(2,6,12,0.6), rgba(2,6,12,0.65)), url("${encodeURI(file)}")`;
  document.body.style.background = url;
  document.body.style.backgroundSize = "cover";
  document.body.style.backgroundPosition = "center";
  console.log("Background set to:", file);
}
setRandomBackground();

// --- UI elements ---
const fileInput = document.getElementById("fileInput");
const preview = document.getElementById("preview");
const analyzeBtn = document.getElementById("analyzeBtn");
const clearBtn = document.getElementById("clearBtn");
const progressInner = document.getElementById("progressInner");
const progressText = document.getElementById("progressText");
const safePct = document.getElementById("safePct");
const fakePct = document.getElementById("fakePct");
const summary = document.getElementById("summary");

let uploadedFile = null;

fileInput.addEventListener("change", () => {
  preview.innerHTML = "";
  uploadedFile = fileInput.files[0];
  if(!uploadedFile){
    preview.textContent = "Preview will appear here";
    return;
  }
  const t = uploadedFile.type;
  if(t.startsWith("image/")){
    const img = document.createElement("img");
    img.src = URL.createObjectURL(uploadedFile);
    img.onload = () => URL.revokeObjectURL(img.src);
    preview.appendChild(img);
  } else if(t.startsWith("video/")){
    const v = document.createElement("video");
    v.src = URL.createObjectURL(uploadedFile);
    v.controls = true;
    v.onloadeddata = () => URL.revokeObjectURL(v.src);
    preview.appendChild(v);
  } else if(t.startsWith("audio/")){
    const a = document.createElement("audio");
    a.src = URL.createObjectURL(uploadedFile);
    a.controls = true;
    a.onloadeddata = () => URL.revokeObjectURL(a.src);
    preview.appendChild(a);
  } else {
    preview.textContent = "Unsupported file type: " + uploadedFile.name;
  }
});

// helper to update UI from backend or simulated data
function showResult({ safe_pct, fake_pct, summary_text }){
  safePct.textContent = (typeof safe_pct === "number" ? safe_pct : 0) + "%";
  fakePct.textContent = (typeof fake_pct === "number" ? fake_pct : 0) + "%";
  summary.textContent = summary_text || "No summary provided";
}

// Analyze -> attempt upload using XMLHttpRequest (so we can show upload progress).
analyzeBtn.addEventListener("click", () => {
  if(!uploadedFile){ alert("Please upload a file first!"); return; }

  progressInner.style.width = "0%";
  progressText.textContent = "Preparing upload...";
  safePct.textContent = "â€”%";
  fakePct.textContent = "â€”%";
  summary.textContent = "Waiting for analysis...";

  const fd = new FormData();
  fd.append("file", uploadedFile);

  // Use XHR so we can show upload progress
  const xhr = new XMLHttpRequest();
  xhr.open("POST", BACKEND_URL, true);
  xhr.timeout = 20000; // 20s timeout

  xhr.upload.onprogress = (e) => {
    if(e.lengthComputable){
      const p = Math.round((e.loaded / e.total) * 100);
      progressInner.style.width = p + "%";
      progressText.textContent = `Uploading... ${p}%`;
    }
  };

  xhr.onload = () => {
    if(xhr.status >= 200 && xhr.status < 300){
      try {
        const data = JSON.parse(xhr.responseText);
        // Expecting { safe_pct, fake_pct, summary }
        showResult({
          safe_pct: data.safe_pct ?? (100 - (data.fake_pct ?? 0)),
          fake_pct: data.fake_pct ?? 0,
          summary_text: data.summary ?? JSON.stringify(data)
        });
        progressInner.style.width = "100%";
        progressText.textContent = "Analysis complete (server)";
      } catch(err){
        console.error("Invalid JSON from server:", err, xhr.responseText);
        simulateFallback(); // fallback to simulated result
      }
    } else {
      console.warn("Server returned status", xhr.status);
      simulateFallback();
    }
  };

  xhr.onerror = () => {
    console.error("Upload error, falling back to simulated analysis.");
    simulateFallback();
  };

  xhr.ontimeout = () => {
    console.error("Upload timed out, falling back to simulated analysis.");
    simulateFallback();
  };

  // send
  try {
    xhr.send(fd);
  } catch(err){
    console.error("XHR send error:", err);
    simulateFallback();
  }
});

// fallback simulated analysis (used if server not reachable)
function simulateFallback(){
  let progress = 0;
  progressInner.style.width = "0%";
  progressText.textContent = "Analyzing (local simulation)...";
  const timer = setInterval(()=>{
    progress += Math.floor(Math.random()*12) + 6; // random steps
    if(progress > 100) progress = 100;
    progressInner.style.width = progress + "%";
    progressText.textContent = `Analyzing... ${progress}%`;
    if(progress >= 100){
      clearInterval(timer);
      const fakeRisk = uploadedFile && uploadedFile.type.startsWith("video/") ? Math.floor(Math.random()*60+20) :
                       uploadedFile && uploadedFile.type.startsWith("image/") ? Math.floor(Math.random()*40+20) :
                       Math.floor(Math.random()*50+30);
      showResult({ safe_pct: 100 - fakeRisk, fake_pct: fakeRisk, summary_text:
        `File Name: ${uploadedFile.name}\nType: ${uploadedFile.type}\nAnalysis (simulated):\nFacial & lip-sync: simulated âœ“\nMetadata check: simulated âœ“\nConfidence (demo): ${100-fakeRisk}%`
      });
      progressText.textContent = "Analysis complete (simulated)";
    }
  }, 220);
}

clearBtn.addEventListener("click", () => {
  fileInput.value = "";
  uploadedFile = null;
  preview.innerHTML = "Preview will appear here";
  progressInner.style.width = "0%";
  progressText.textContent = "Idle";
  safePct.textContent = "â€”%";
  fakePct.textContent = "â€”%";
  summary.textContent = "No analysis yet.";
});
</script>
</body>
</html>
