<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Deepfake Defender</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --accent1: #00ffe5;
    --accent2: #b388ff;
    --card-bg: rgba(10,12,18,0.86);
    --muted: #b1cbe0;
  }

  html, body {
    height: 100%;
    margin: 0;
    font-family: Inter, system-ui, sans-serif;
    color: #e6f8ff;
    background: linear-gradient(135deg,#071021,#0b1220 60%, #071026);
    background-size: cover;
    background-position: center;
  }

  .bgOverlay {
    position: fixed;
    inset: 0;
    pointer-events: none;
    background: linear-gradient(rgba(2,6,12,0.55), rgba(2,6,12,0.65));
    z-index: 0;
  }

  /* LOGIN OVERLAY */
  #loginOverlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 99;
  }

  #loginBox {
    background: var(--card-bg);
    padding: 30px;
    border-radius: 14px;
    text-align: center;
    width: 320px;
    box-shadow: 0 0 25px rgba(0,0,0,0.7);
  }

  #loginBox h2 {
    font-family:'Orbitron', sans-serif;
    color: var(--accent1);
    margin-bottom: 20px;
  }

  #loginBox input {
    width: 100%;
    padding: 10px;
    margin-bottom: 12px;
    border-radius: 8px;
    border: 1px solid rgba(179,136,255,0.2);
    background: rgba(255,255,255,0.05);
    color: #fff;
  }

  #loginError {
    color: #ff8080;
    display: none;
    margin-top: 8px;
  }

  /* MAIN APP PAGE */
  .page {
    position: relative;
    z-index: 2;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    box-sizing: border-box;
  }

  .container {
    width: 100%;
    max-width: 1100px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 22px;
    align-items: start;
    justify-items: center; /* center horizontally */
  }

  header {
    grid-column: 1 / -1;
    text-align: center;
    margin-bottom: 10px;
  }

  h1 {
    font-family: 'Orbitron', sans-serif;
    margin: 0;
    color: var(--accent1);
    font-size: 36px;
  }

  p.subtitle {
    margin: 6px 0 18px;
    color: var(--accent2);
    opacity: 0.95;
    font-weight: 600;
  }

  .card {
    background: var(--card-bg);
    border-radius: 14px;
    padding: 20px;
    box-shadow: 0 6px 30px rgba(2,10,20,0.6);
    border: 1px solid rgba(0,255,229,0.06);
    width: 100%;
    max-width: 500px;
  }

  h3 {
    font-family: 'Orbitron', sans-serif;
    margin: 0 0 12px;
    color: var(--accent1);
    font-size: 18px;
  }

  .controls {
    display: flex;
    gap: 10px;
    flex-direction: column;
  }

  input[type=file] {
    border-radius: 10px;
    padding: 10px;
    border: 1px dashed rgba(179,136,255,0.18);
    background: rgba(255,255,255,0.02);
    color: var(--muted);
  }

  .btn {
    border: 0;
    cursor: pointer;
    padding: 10px 14px;
    border-radius: 10px;
    font-weight: 700;
    color: #071021;
    background: linear-gradient(90deg,var(--accent1),var(--accent2));
  }

  .btn:active {
    transform: translateY(1px);
  }

  .preview {
    margin-top: 14px;
    height: 260px;
    border-radius: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    border: 1px solid rgba(179,136,255,0.06);
  }

  .preview img, .preview video, .preview audio {
    max-width: 100%;
    max-height: 100%;
    border-radius: 8px;
  }

  .progressOuter {
    margin-top: 12px;
    height: 12px;
    background: rgba(255,255,255,0.04);
    border-radius: 12px;
    overflow: hidden;
  }

  .progressInner {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg,var(--accent1),var(--accent2));
    transition: width .2s;
  }

  .metrics {
    display: flex;
    gap: 12px;
    margin-top: 16px;
  }

  .metric {
    flex: 1;
    padding: 14px 8px;
    background: rgba(0,0,0,0.35);
    border-radius: 10px;
    text-align: center;
  }

  .metric p {
    margin: 0;
    color: var(--accent2);
    font-size: 13px;
  }

  .metric h2 {
    margin: 6px 0 0;
    color: var(--accent1);
    font-size: 26px;
  }

  pre#summary {
    margin-top: 14px;
    background: #07101a;
    padding: 12px;
    border-radius: 8px;
    color: #cfefff;
    font-size: 13px;
    min-height: 100px;
  }

  footer {
    grid-column: 1 / -1;
    margin-top: 18px;
    text-align: center;
    color: var(--accent2);
    font-size: 13px;
  }
</style>
</head>
<body>

<div class="bgOverlay"></div>

<!-- LOGIN OVERLAY -->
<div id="loginOverlay">
  <div id="loginBox">
    <h2>Login<br/>user=admin<br/>password=password123</h2>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <button class="btn" id="loginBtn" style="width:100%;margin-top:10px;">Login</button>
    <p id="loginError">Invalid username or password</p>
  </div>
</div>

<!-- MAIN APP -->
<div class="page" id="appContent" style="display:none;">
  <div class="container">
    <header>
      <h1>Deepfake Defender</h1>
      <p class="subtitle">Upload image â€¢ video â€¢ audio â€” detect manipulated media</p>
    </header>

    <!-- LEFT CARD -->
    <div class="card">
      <h3>Upload Media</h3>
      <div class="controls">
        <input type="file" id="fileInput" accept="image/*,video/*,audio/*" />
        <div style="display:flex; gap:10px;">
          <button class="btn" id="analyzeBtn">Analyze</button>
          <button class="btn" id="clearBtn" style="background:transparent;color:var(--accent1);border:1px solid rgba(179,136,255,0.14)">Clear</button>
        </div>
      </div>
      <div class="preview" id="preview">Preview will appear here</div>
      <div class="progressOuter"><div class="progressInner" id="progressInner"></div></div>
      <p id="progressText" style="margin-top:8px;color:var(--muted)">Idle</p>
    </div>

    <!-- RIGHT CARD -->
    <div class="card">
      <h3>Results</h3>
      <div class="metrics">
        <div class="metric"><p>Safe Probability</p><h2 id="safePct">â€”%</h2></div>
        <div class="metric"><p>Risk of Fake</p><h2 id="fakePct">â€”%</h2></div>
      </div>
      <pre id="summary">No analysis yet.</pre>
    </div>

    <footer>ðŸ”’ Cybersecurity Awareness â€” Trust, but Verify</footer>
  </div>
</div>

<script>
const DEMO_USER="admin", DEMO_PASS="password123";
const loginBtn=document.getElementById("loginBtn"), loginError=document.getElementById("loginError");
const loginOverlay=document.getElementById("loginOverlay"), appContent=document.getElementById("appContent");

loginBtn.addEventListener("click",()=>{
  const u=document.getElementById("username").value, p=document.getElementById("password").value;
  if(u===DEMO_USER && p===DEMO_PASS){
    loginOverlay.style.display="none";
    appContent.style.display="flex"; // show main page
  } else {
    loginError.style.display="block";
  }
});

const BACKEND_URL="http://127.0.0.1:8000/analyze";
const fileInput=document.getElementById("fileInput"), preview=document.getElementById("preview");
const analyzeBtn=document.getElementById("analyzeBtn"), clearBtn=document.getElementById("clearBtn");
const progressInner=document.getElementById("progressInner"), progressText=document.getElementById("progressText");
const safePct=document.getElementById("safePct"), fakePct=document.getElementById("fakePct"), summary=document.getElementById("summary");

let uploadedFile=null;

fileInput.addEventListener("change",()=>{
  preview.innerHTML="";
  uploadedFile=fileInput.files[0];
  if(!uploadedFile){ preview.textContent="Preview will appear here"; return; }
  const t=uploadedFile.type;
  if(t.startsWith("image/")){
    const img=document.createElement("img");
    img.src=URL.createObjectURL(uploadedFile);
    preview.appendChild(img);
  } else if(t.startsWith("video/")){
    const v=document.createElement("video");
    v.src=URL.createObjectURL(uploadedFile);
    v.controls=true;
    preview.appendChild(v);
  } else if(t.startsWith("audio/")){
    const a=document.createElement("audio");
    a.src=URL.createObjectURL(uploadedFile);
    a.controls=true;
    preview.appendChild(a);
  } else {
    preview.textContent="Unsupported file type: "+uploadedFile.name;
  }
});

function showResult({safe_pct,fake_pct,summary_text}){
  safePct.textContent=(safe_pct||0)+"%";
  fakePct.textContent=(fake_pct||0)+"%";
  summary.textContent=summary_text||"No summary provided";
}

analyzeBtn.addEventListener("click",()=>{
  if(!uploadedFile){alert("Please upload a file first!");return;}
  progressInner.style.width="0%"; progressText.textContent="Preparing upload...";
  safePct.textContent="â€”%"; fakePct.textContent="â€”%"; summary.textContent="Waiting for analysis...";
  const fd=new FormData(); fd.append("file",uploadedFile);
  const xhr=new XMLHttpRequest(); xhr.open("POST",BACKEND_URL,true); xhr.timeout=20000;
  xhr.upload.onprogress=(e)=>{
    if(e.lengthComputable){
      const p=Math.round((e.loaded/e.total)*100);
      progressInner.style.width=p+"%";
      progressText.textContent=`Uploading... ${p}%`;
    }
  };
  xhr.onload=()=>{if(xhr.status>=200&&xhr.status<300){try{const data=JSON.parse(xhr.responseText);
    showResult({safe_pct:data.safe_pct??(100-(data.fake_pct??0)),fake_pct:data.fake_pct??0,summary_text:data.summary??JSON.stringify(data)});
    progressInner.style.width="100%"; progressText.textContent="Analysis complete (server)";}
    catch(err){simulateFallback();}} else{simulateFallback();}};
  xhr.onerror=()=>simulateFallback(); xhr.ontimeout=()=>simulateFallback();
  try{xhr.send(fd);}catch(err){simulateFallback();}
});

function simulateFallback(){
  let progress=0; progressInner.style.width="0%"; progressText.textContent="Analyzing (simulated)...";
  const timer=setInterval(()=>{
    progress+=Math.floor(Math.random()*12)+6; if(progress>100)progress=100;
    progressInner.style.width=progress+"%"; progressText.textContent=`Analyzing... ${progress}%`;
    if(progress>=100){clearInterval(timer);
      const fakeRisk=uploadedFile&&uploadedFile.type.startsWith("video/")?Math.floor(Math.random()*60+20)
        :uploadedFile&&uploadedFile.type.startsWith("image/")?Math.floor(Math.random()*40+20)
        :Math.floor(Math.random()*50+30);
      showResult({safe_pct:100-fakeRisk,fake_pct:fakeRisk,
        summary_text:`File: ${uploadedFile.name}\nType: ${uploadedFile.type}\nAnalysis (simulated)`});
      progressText.textContent="Analysis complete (simulated)";
    }
  },220);
}

clearBtn.addEventListener("click",()=>{
  fileInput.value=""; uploadedFile=null; preview.innerHTML="Preview will appear here";
  progressInner.style.width="0%"; progressText.textContent="Idle";
  safePct.textContent="â€”%"; fakePct.textContent="â€”%"; summary.textContent="No analysis yet.";
});
</script>
</body>
</html>
